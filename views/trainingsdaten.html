<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--Bootstrap-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!--Leaflet-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!--Leaflet Draw-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.js"></script>
<<<<<<< Updated upstream
    <!-- Own stylesheet-->
=======

    <!--<script(src='JS/trainingsdaten.js')></script>!-->
    <!--OPenEO JS Client:-->
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/oidc-client@1/dist/oidc-client.min.js"></script>
    <!-- Only required if you'd like to enable authentication via OpenID Connect -->
    <script src="https://cdn.jsdelivr.net/npm/multihashes@3/src/index.min.js"></script>
    <!-- Only required if you have checksums in the STAC metadata -->
    <script src="https://cdn.jsdelivr.net/npm/@openeo/js-client@2/openeo.min.js"></script>

    <!--Own stylesheet:-->
>>>>>>> Stashed changes
    <link rel="stylesheet" href="stylesheets/style.css">
    <title>Copernicus Code Crafters</title>
</head>

<body>
    <header class="mb-3">
        <nav class="navbar navbar-expand-lg navbar-light bg-secondary"><a class="navbar-brand active"
                area-current="page" href="/">CCC Clasifier</a><button class="navbar-toggler" type="button"
                data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item"><a class="nav-link active" area-current="page"
                            href="/webpage">Trainingsdatenverwalten
                    <li class="nav-item active"></li></a></li>
                    <li class="nav-item"><a class="nav-link active" area-current="page" href="/impressum">Impressum </a>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0"><label class="switch"><input id="dark_mode_button"
                            type="checkbox" checked=""><span class="slider round"></span></label></form>
            </div>
        </nav>
    </header>
<<<<<<< Updated upstream
    <div class="container">
        <div class="row gy-4 gx-lg-3 justify-content-md-center mt-">
            <div class="col-lg-6">
                <div class="card shadow p-3 h-100 bg-secondary rounded">
                    <h2 class="card-title">Hauptsitz:</h2>
                    <div class="karte">
                        <!-- Add any content for the map here -->
                    </div>
                    <div id="map2"></div>
                    <br>
                        <label for="avatar">Choose Trainingsdata:</label>

                        <form id="uploadForm" action="/trainingsdaten/upload" method="post" enctype="multipart/form-data">
                            <input type="file" name="file" accept=".gpkg, .geojson">
                            <button type="submit">Upload File</button>
                          </form>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow p-3 h-100 bg-secondary rounded">
                    <h2 class="card-title">Impressum:</h2>
                    <p>
                        Anbieter:<br>
                        Copernicus Code Crafters<br>
                        GEO1, Heisenbergstraße 2<br>
                        48149 Münster
                    </p>
                    <p>&nbsp;</p>
                    <p>&nbsp;</p>
                    <p>
                        Kontakt:<br>
                        Telefon: 0157/1234567-8<br>
                        Telefax: 0800/1234567-9<br>
                        E-Mail: ccc@info.de<br>
                        Website: <a
                            href="https://github.com/CopernicusCodeCrafters">https://github.com/CopernicusCodeCrafters</a>
                    </p>
=======
    <div class="container-fluid">
        <div class="row gy-4 gx-lg-3 justify-content-md-center mt-">
            <div class="col-lg-9">
                <div class="card shadow p-3 h-100 bg-secondary rounded">
                    <h2 class="card-title">Viewer</h2>
                    <div id="map"></div>
                    <script>
                        var map = L.map('map').setView([51.305915044598834,10.21774343122064], 6);
                        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                        }).addTo(map);
                    </script>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card shadow p-3 h-100 bg-secondary rounded">
                    <h2 class="card-title">Upload</h2><br>
                    <form id="uploadForm" onsubmit="handleFile(event)" enctype="multipart/form-data">
                        <input type="file" name="file" accept=".gpkg, .geojson">
                        <button type="submit">Upload File</button>
                    </form>
                    <div id="savedDataButton"></div>

>>>>>>> Stashed changes

                </div>
            </div>
        </div>
    </div>

<<<<<<< Updated upstream
    <!-- JavaScript for creating the map -->
    <script>
        // Create Map
        var map = L.map('map2').setView([51.305915044598834,10.21774343122064], 6);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        function handleFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();

                reader.onload = function (e) {
                const arrayBuffer = e.target.result;

                if (file.name.endsWith('.gpkg')) {
                    handleGeoPackage(arrayBuffer);
                } else if (file.name.endsWith('.geojson')) {
                    handleGeoJSON(arrayBuffer);
                } else {
                    alert('Unsupported file format. Please select a GeoPackage (.gpkg) or GeoJSON (.geojson) file.');
                }
                };

                reader.readAsArrayBuffer(file);
            } else {
                alert('Please select a file.');
            }
    }

    function handleGeoPackage(arrayBuffer) {
      geopackage.open(arrayBuffer, function(err, result) {
        if (err) {
          console.error('Error opening GeoPackage:', err);
        } else {
          console.log('GeoPackage opened successfully:', result);
          try {
            L.geoPackageFeatureLayer([], {
                geoPackageUrl: 'https://ngageoint.github.io/GeoPackage/examples/rivers.gpkg',
                layerName: 'rivers',
                style: function(feature) {
                return {
                    color: '#F00',
                    weight: 2,
                    opacity: 1,
                };
                }
            }).addTo(map);
        } catch (e) {
            console.error(e);
}

        }
      });
    }

    function handleGeoJSON(arrayBuffer) {
      const geoJSON = JSON.parse(new TextDecoder('utf-8').decode(arrayBuffer));
      console.log('GeoJSON loaded successfully:', geoJSON);
      let geoJSONLayer = L.geoJSON(geoJSON).addTo(map);
      map.fitBounds(geoJSONLayer.getBounds());
    }
    </script>
    
    <div class="container">
=======
    
    </div>
    <div class="container-fluid">
>>>>>>> Stashed changes
        <footer>
            <div class="d-flex flex-wrap justify-content-between align-items-center py-1 my-3 border-top">
                <p class="col-md-4 mb-0 text-body-secondary">&copy; 2023 Copernicus Code Crafters, Inc</p><a
                    class="col-md-4 d-flex align-items-center justify-content-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none"
                    href="/"><svg class="bi me-2" width="40" height="32">
                        <use xlink:href="#bootstrap"></use>
                    </svg></a>
                <ul class="nav col-md-4 justify-content-end">
                    <li class="nav-item"><a class="nav-link px-2 text-body-secondary active" area-current="page"
                            href="/impressum">Impressum</a></li>
                </ul>
            </div>
        </footer>
    </div>
<<<<<<< Updated upstream


    <footer>
        <div class="navbar navbar-expand-md bg-secondary bg-gradient rounded justify-content-center"><span
                class="text-grey">Geosoftware 2</span></div>
    </footer>
</body>

</html>
=======
<script>

    function handleFile(event) {
  console.log("test44444")
    event.preventDefault();

    const fileInput = document.querySelector('input[type="file"]');
    const file = fileInput.files[0];

    if (file) {
      const fileName = file.name.toLowerCase();

      // Check if it's a GeoJSON file
      if (fileName.endsWith('.geojson')) {
        const reader = new FileReader();

        reader.onload = function (e) {
          const geoJsonData = JSON.parse(e.target.result);
          setGeojsonToMap(geoJsonData);
        };

        reader.readAsText(file);
      }
      // Check if it's a GeoPackage file
      else if (fileName.endsWith('.gpkg')) {
        const gpkgLayer = L.geoPackageTileLayer({
            geoPackageUrl: file,
            layerName: 'features'
        }).addTo(map);
        gpkgLayer.once('load', function () {
          map.fitBounds(gpkgLayer.getBounds());
        });
      } else {
        console.log('Invalid file format. Supported formats: GeoJSON (.geojson) or GeoPackage (.gpkg)');
      }
    } else {
      console.log('No file selected');
    }
  }
  const customControl = L.Control.extend({
  // button position
  options: {
    position: "topright",
  },

  // method
  onAdd: function () {
    const array = [
      {
        title: "export features geojson",
        html: "<svg class='icon-geojson'><use xlink:href='#icon-export'></use></svg>",
        className: "export link-button leaflet-bar",
      },
      {
        title: "save geojson",
        html: "<svg class='icon-geojson'><use xlink:href='#icon-add'></use></svg>",
        className: "save link-button leaflet-bar",
      },
      {
        title: "remove geojson",
        html: "<svg class='icon-geojson'><use xlink:href='#icon-remove'></use></svg>",
        className: "remove link-button leaflet-bar",
      },
      {
        title: "load gejson from file",
        html: "<input type='file' id='geojson' class='geojson' accept='text/plain, text/json, .geojson' onchange='openFile(event)' /><label for='geojson'><svg class='icon-geojson'><use xlink:href='#icon-import'></use></svg></label>",
        className: "load link-button leaflet-bar",
      },
    ];

    const container = L.DomUtil.create(
      "div",
      "leaflet-control leaflet-action-button"
    );

    array.forEach((item) => {
      const button = L.DomUtil.create("a");
      button.href = "#";
      button.setAttribute("role", "button");

      button.title = item.title;
      button.innerHTML = item.html;
      button.className += item.className;

      // add buttons to container;
      container.appendChild(button);
    });

    return container;
  },
});
map.addControl(new customControl());

// Drow polygon, circle, rectangle, polyline
// --------------------------------------------------

let drawnItems = L.featureGroup().addTo(map);

map.addControl(
  new L.Control.Draw({
    edit: {
      featureGroup: drawnItems,
      poly: {
        allowIntersection: false,
      },
    },
    draw: {
      polygon: {
        allowIntersection: false,
        showArea: true,
      },
    },
  })
);

map.on(L.Draw.Event.CREATED, function (event) {
  let layer = event.layer;
  let feature = (layer.feature = layer.feature || {});
  let type = event.layerType;

  feature.type = feature.type || "Feature";
  let props = (feature.properties = feature.properties || {});

  props.type = type;

  if (type === "circle") {
    props.radius = layer.getRadius();
  }

  drawnItems.addLayer(layer);
});

// --------------------------------------------------
// save geojson to file

const exportJSON = document.querySelector(".export");

exportJSON.addEventListener("click", () => {
  // Extract GeoJson from featureGroup
  const data = drawnItems.toGeoJSON();

  if (data.features.length === 0) {
    Notiflix.Notify.failure("You must have some data to save a geojson file");
    return;
  } else {
    Notiflix.Notify.info("You can save the data to a geojson");
  }

  // Stringify the GeoJson
  const convertedData =
    "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));

  exportJSON.setAttribute("href", "data:" + convertedData);
  exportJSON.setAttribute("download", "data.geojson");
});

// --------------------------------------------------
// save geojson to localstorage
const saveJSON = document.querySelector(".save");

saveJSON.addEventListener("click", (e) => {
  e.preventDefault();

  const data = drawnItems.toGeoJSON();

  if (data.features.length === 0) {
    alert("You must have some data to save it");
    return;
  } else {
    alert("The data has been saved to localstorage");
  }

  localStorage.setItem("geojson", JSON.stringify(data));
});

// --------------------------------------------------
// remove gojson from localstorage

const removeJSON = document.querySelector(".remove");

removeJSON.addEventListener("click", (e) => {
  e.preventDefault();
  localStorage.removeItem("geojson");

  Notiflix.Notify.info("All layers have been deleted");

  drawnItems.eachLayer(function (layer) {
    drawnItems.removeLayer(layer);
  });
});

// --------------------------------------------------
// load geojson from localstorage

const geojsonFromLocalStorage = JSON.parse(localStorage.getItem("geojson"));

function setGeojsonToMap(geojson) {
  const feature = L.geoJSON(geojson, {
    style: function (feature) {
      return {
        color: "red",
        weight: 2,
      };
    },
    pointToLayer: (feature, latlng) => {
      if (feature.properties.type === "circle") {
        return new L.circle(latlng, {
          radius: feature.properties.radius,
        });
      } else if (feature.properties.type === "circlemarker") {
        return new L.circleMarker(latlng, {
          radius: 10,
        });
      } else {
        return new L.Marker(latlng);
      }
    },
    onEachFeature: function (feature, layer) {
      drawnItems.addLayer(layer);
      const coordinates = feature.geometry.coordinates.toString();
      const result = coordinates.match(/[^,]+,[^,]+/g);

      layer.bindPopup(
        "<span>Coordinates:<br>" + result.join("<br>") + "</span>"
      );
    },
  }).addTo(map);

  map.flyToBounds(feature.getBounds());
}

if (geojsonFromLocalStorage) {
  setGeojsonToMap(geojsonFromLocalStorage);
}

// --------------------------------------------------
// get geojson from file

function openFile(event) {
  const input = event.target;

  const reader = new FileReader();
  reader.onload = function () {
    const result = reader.result;
    const geojson = JSON.parse(result);

    

    setGeojsonToMap(geojson);
  };
  reader.readAsText(input.files[0]);
}
function displaySavedJSON() {
  const savedJSON = localStorage.getItem("geojson");

  if (savedJSON) {
    const savedDataButton = document.createElement("button");
    savedDataButton.textContent = "Load Saved GeoJSON";
    savedDataButton.classList.add("savedJSONButton");

    savedDataButton.addEventListener("click", () => {
      const data = JSON.parse(savedJSON);
      // Perform actions with the loaded GeoJSON data, for example:
      // You can use the data to add it to the map or perform other operations

      // Example: Alert the GeoJSON data
      alert("Loaded GeoJSON Data: " + JSON.stringify(data));
    });

    document.getElementById("savedDataButton").appendChild(savedDataButton);
  }
}

// Event listener for saving GeoJSON
const saveGeoJSON = document.querySelector(".save");
saveGeoJSON.addEventListener("click", (e) => {
  e.preventDefault();

  const data = drawnItems.toGeoJSON();

  if (data.features.length === 0) {
    alert("You must have some data to save it");
    return;
  } else {
    alert("The data has been saved to local storage");
  }

  localStorage.setItem("geojson", JSON.stringify(data));
  displaySavedJSON(); // Call function to display the saved JSON as a button
});

// Call the function when the page loads to check if there's saved GeoJSON
window.addEventListener("load", displaySavedJSON);
</script>
>>>>>>> Stashed changes
